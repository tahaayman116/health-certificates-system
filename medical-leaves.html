<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<meta name="theme-color" content="#000000">
	<link rel="icon" href="./medical-leaves/seha_logo.svg">
	<link rel="apple-touch-icon" href="./medical-leaves/seha_logo.svg">
	<title>الإجازات المرضية - نظام إدارة الشهادات الصحية</title>
	<meta name="description" content="خدمة الاستعلام عن الإجازات المرضية">

	<link href="./medical-leaves/css2.css" rel="stylesheet">
	<link href="./medical-leaves/main.css" rel="stylesheet">
</head>

	<div id="root">
		<div class="App">
			<main>
				<div>
					<!-- Navbar Section -->
					<nav class="header navbar navbar-expand-lg navbar-light bg-light">
						<div class="nav-container">
							<a class="navbar-brand" href="#" onclick="return false;">
								<img src="./medical-leaves/seha_logo.svg" alt="logo" class="logo">
                            </a>

                            <!-- Toggler for mobile menu -->
                            <div class="d-lg-none d-xl-none justify-content-end menu">
                                <button aria-controls="responsive-navbar-nav" type="button" aria-label="Toggle navigation" class="d-inline-flex menu-img navbar-toggler collapsed"style="cursor: pointer; appearance: none; font-family: Cairo, sans-serif; font-size: 20px; line-height: 20px; margin: 0; outline: none; border-radius: 10px; box-sizing: border-box; align-items: center; height: 39.9994px; justify-content: center; padding: 0; width: 40px; background-color: rgba(0, 0, 0, 0); border: none; display: flex; color: rgba(0, 0, 0, 0.65); transition: box-shadow 0.15s ease-in-out; overflow: visible; touch-action: manipulation;"
  onclick="toggleIcon(this)">
                                    <span class="menu-icon"
    style="box-sizing: border-box; height: 35.9983px; width: 20px; background-image: url('./medical-leaves/services/images/menu.svg'); background-position: 50% 50%; background-repeat: no-repeat; background-size: 100%; display: block; vertical-align: middle;">
  </span>
                                </button>
                                <script>
  function toggleIcon(button) {
    const icon = button.querySelector('.menu-icon');
    const menuIconUrl = './medical-leaves/menu-close.svg';
    const closeIconUrl = './medical-leaves/menu.svg';

    if (icon.style.backgroundImage.includes(menuIconUrl)) {
      icon.style.backgroundImage = `url('${closeIconUrl}')`;
    } else {
      icon.style.backgroundImage = `url('${menuIconUrl}')`;
    }
  }
</script>   
                            </div>

                            <!-- Navbar Links -->
                            <div class="white justify-content-between navbar-collapse collapse" id="responsive-navbar-nav">
            <div class="justify-content-between navbar-nav">
                <a class="link nav-link" href="#" onclick="return false;">الرئيسية</a>
                <a class="link nav-link" href="#" onclick="return false;">لوحة التحكم</a>
                <a class="link nav-link" href="#" onclick="return false;">الشهادات الصحية</a>
                <a class="link nav-link" href="#" onclick="return false;">الإجازات المرضية</a>
            </div>
            <div class="justify-content-between navbar-nav">
                <a class="nav-link" href="#" onclick="return false;"><p>تسجيل الدخول</p></a>
            </div>
        </div>
    </div>

                        <!-- Scroll to Top Button -->
                        <button id="top-button" style="display: none;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14.4" height="18.503" viewBox="0 0 14.4 18.503">
                                <path d="M8.862,11.37,14.381,6.1a1.7,1.7,0,0,1,2.355,0l5.54,5.272a1.555,1.555,0,0,1,0,2.271,1.738,1.738,0,0,1-2.376,0l-2.649-2.528V22.519a1.684,1.684,0,0,1-3.364,0V11.113l-2.649,2.534a1.738,1.738,0,0,1-2.376,0,1.561,1.561,0,0,1,0-2.276Z" fill="#00a1c9"></path>
                            </svg>
                        </button>
                    </nav>
                    

                    <!-- Content Section -->
                    <div class="inner-page inquiries-container">
                        <h1 style="font-size:40px;color:rgb(48, 109, 181);font-weight:700;line-height:48px;margin-bottom:8px;margin-top:20px;box-sizing:border-box;background-image:url('https://www.seha.sa/static/media/rectangle.62441ab88b5bcc89755a.svg');background-position:50% 50%;background-repeat:no-repeat;display:block;font-family:Cairo, sans-serif;position:relative;">الإجازات المرضية</h1>
                        <p class="sub-heading">خدمة الاستعلام عن الإجازات المرضية تتيح لك الاستعلام عن حالة طلبك للإجازة ويمكنك طباعتها عن طريق تطبيق صحتي</p>

                        <div class="row justify-content-center mt-1">
                            <div class="col-md-5 p-4">
                                <!-- Results Section -->
                                <div class="inquiry-form-group">
                                    <input type="text" id="service_code" maxlength="14" placeholder="رمز الخدمة" class="form-control" required><br>   
                
                                    <input type="text" id="id_number" maxlength="10" pattern="\d*" placeholder="رقم الهوية / الإقامة" class="form-control" required>  
                                   
                                    <div id="error-message" class="alert alert-danger" style="display: none;"> لا يوجد نتائج </div>
                                       
                                   
                                    <button id="inquiry-btn" class="btn btn-primary" style="margin-top: 10px;" onclick="submitInquiry()">استعلام</button>
                                
                                <div id="result" class="result-section"></div>
                            
                            <div id="new-inquiry-btn" style="display: none;">
                                <button class="btn btn-primary mt-3" onclick="window.location.reload()">استعلام جديد</button>
                            </div>
                            <a id="back-btn" class="btn btn-primary mb-3 mt-3" href="#" onclick="window.location.reload()">رجوع للاستعلامات</a>
                        </div>
                    </div>
                        
                     
                    <div class="footer-container container-fluid">
                        <div class="footer">
                            <div class="about section">
                                <img src="./medical-leaves/logo-white-CKxLEirV.svg" alt="Logo">
                                <p class="about">منصة صحة تخدم جميع المنشأت الطبية من خلال تقديم الخدمات الصحية إلكترونياً لجميع المنشأت الطبية وتسعى إلى توحيد وأتمتة الاجراءات والخدمات بما في دوره رفع جودة الاداء وخفض التكاليف.</p>
                            </div>
                            <div class="links section" style="align-items: center;">
                                <h3 class="heading">القائمة الرئيسية</h3>
                                <ul class="links-wrapepr">
                                    <li class="inquiry-li">
                                        <a class="nav-link" href="#" onclick="return false;">لوحة التحكم</a>
                                    </li>
                                    <li class="inquiry-li">
                                        <a class="nav-link" href="#" onclick="return false;">الشهادات الصحية</a>
                                    </li>
                                    <li class="inquiry-li">
                                        <a class="nav-link" href="#" onclick="return false;">الإجازات المرضية</a>
                                    </li>
                                    <li class="inquiry-li" style="border-bottom: none;">
                                        <a class="nav-link" href="#" onclick="return false;">تسجيل الدخول</a>
                                    </li>
                                </ul>
                            </div>
                            <div class="contact section">
                                <h3 class="heading">تواصل معنا</h3>
                                <div class="contact-wrapper">
                                    <div class="values">
                                        <div class="details">
                                            <img alt="phone icon" src="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='13.667'%20height='13.662'%20viewBox='0%200%2013.667%2013.662'%3e%3cpath%20id='phone'%20d='M15.455,17.037h-.089C5.04,16.443,3.574,7.731,3.369,5.072a1.576,1.576,0,0,1,1.45-1.7h2.9a1.051,1.051,0,0,1,.978.662L9.491,6a1.051,1.051,0,0,1-.231,1.135L8.14,8.267a4.923,4.923,0,0,0,3.983,3.993l1.14-1.13a1.051,1.051,0,0,1,1.14-.215l1.981.794a1.051,1.051,0,0,1,.647.977V15.46a1.576,1.576,0,0,1-1.576,1.576ZM4.946,4.426a.525.525,0,0,0-.525.525v.042c.242,3.111,1.792,10.467,11,10.992a.525.525,0,0,0,.557-.494V12.686L14,11.892l-1.508,1.5-.252-.032c-4.571-.573-5.191-5.144-5.191-5.191l-.032-.252L8.508,6.406,7.72,4.426Z'%20transform='translate(-3.364%20-3.375)'%20fill='%237eb7db'/%3e%3c/svg%3e">
                                            <a href="tel:920002005">920002005</a>
                                        </div>
                                        <div class="details">
                                            <img alt="email line" src="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='13.667'%20height='10.25'%20viewBox='0%200%2013.667%2010.25'%3e%3cpath%20id='email-line'%20d='M14.812,6H2.854A.854.854,0,0,0,2,6.854V15.4a.854.854,0,0,0,.854.854H14.812a.854.854,0,0,0,.854-.854V6.854A.854.854,0,0,0,14.812,6Zm-.658,9.4H3.563L6.553,12.3l-.615-.594L2.854,14.9V7.5l5.309,5.283a.854.854,0,0,0,1.2,0l5.445-5.415v7.474L11.669,11.7l-.6.6ZM3.414,6.854H14.121L8.765,12.18Z'%20transform='translate(-2%20-6)'%20fill='%237eb7db'/%3e%3c/svg%3e">
                                            <a href="mailto:support@seha.sa">support@seha.sa</a>
                                        </div>
                                        <div class="timings mt-3">
                                            <span style="font-size: 12px; color: rgb(240, 243, 248);">أوقات العمل: الأحد حتى الخميس 8 ص - 11م</span>
                                        </div>
                                    </div>
                                    <div class="contact">
                                        <img alt="lean logo" src="./medical-leaves/lean-logo.svg">
                                        <div class="spacer"></div>
                                        <img alt="moh logo" src="./medical-leaves/MOH-logo.svg">
                                    </div>
                                </div>
                                <div class="footer-note-wrapper">
                                    <p>منصة صحة معتمدة من قبل وزارة الصحة © 2025 </p>
                                    <ul>
                                        <li>
                                            <a>سياسة الخصوصية وشروط الإستخدام</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
           <!-- JavaScript Section -->
    <script src="./medical-leaves/jquery.min.js"></script>
    <script src="./medical-leaves/script.js"></script>
    
    <!-- Firebase Configuration -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getFirestore, collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';
        
        // Firebase config (نفس الإعدادات المستخدمة للشهادات)
        const firebaseConfig = {
            apiKey: "AIzaSyDOVmQ5HY0KrsaITu3Sl55-gjPwoKLPguE",
            authDomain: "certificates-8b2bb.firebaseapp.com",
            projectId: "certificates-8b2bb",
            storageBucket: "certificates-8b2bb.firebasestorage.app",
            messagingSenderId: "865099561039",
            appId: "1:865099561039:web:644ec7c3ffce81cd77523a",
            measurementId: "G-C2P94SNR6D"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Make Firebase available globally
        window.db = db;
        window.firebaseModules = {
            collection, query, where, getDocs
        };
    </script>
    
        <!-- Script to fetch and display data -->
    <script>$(document).ready(function() {
            // Toggling the 'collapsed' class when the button is clicked
            $('.navbar-toggler').on('click', function() {
                $(this).toggleClass('collapsed');
                $('#responsive-navbar-nav').toggleClass('show');
            });
        });
        
        // وظيفة الاستعلام الجديدة
        async function submitInquiry() {
                // انتظار تحميل Firebase
    if (!window.db || !window.firebaseModules) {
        setTimeout(submitInquiry, 500);
        return;
    }
            const serviceCode = document.getElementById("service_code").value;
            const idNumber = document.getElementById("id_number").value;
            const errorMessage = document.getElementById('error-message');
            const result = document.getElementById('result');
            const newInquiryBtn = document.getElementById('new-inquiry-btn');
            const inquiryBtn = document.getElementById('inquiry-btn');

            // إخفاء الرسائل السابقة
            errorMessage.style.display = 'none';
            result.innerHTML = '';
            result.style.display = 'none';

            if (!serviceCode || !idNumber) {
                errorMessage.textContent = 'يرجى إدخال رمز الخدمة ورقم الهوية';
                errorMessage.style.display = 'block';
                return;
            }

            try {
                let data = null;
                
                // مسح localStorage القديم أولاً
                const localKey = `medical-leave-${serviceCode}-${idNumber}`;
                localStorage.removeItem(localKey);
                console.log('🗑️ تم مسح البيانات المحلية القديمة');
                
                // البحث في Firebase فقط (تجاهل localStorage تماماً)
                console.log('🔍 البحث في Firebase فقط (تجاهل localStorage)...');
                
                // البحث في Firebase فقط - نفس طريقة admin-dashboard
                if (window.db && window.firebaseModules) {
                        try {
                            console.log('🔍 البحث في جميع المستندات للعثور على الإجازة المرضية...');
                            
                            // جلب جميع المستندات والبحث عن الإجازة المرضية
                            const querySnapshot = await window.firebaseModules.getDocs(
                                window.firebaseModules.collection(window.db, 'certificates')
                            );
                            
                            let foundDoc = null;
                            
                            querySnapshot.forEach((doc) => {
                                const docData = doc.data();
                                console.log('📄 فحص المستند:', doc.id, docData);
                                
                                // البحث عن الإجازة المرضية بعدة طرق
                                if (
                                    (docData.serviceCode === serviceCode && docData.idNumber === idNumber) ||
                                    (docData.serviceCode === serviceCode && docData.medicalIdNumber === idNumber)
                                ) {
                                    // التأكد أنها إجازة مرضية وليس شهادة صحية
                                    if (docData.serviceCode && !docData.amanah && !docData.municipality) {
                                        foundDoc = docData;
                                        console.log('✅ تم العثور على الإجازة المرضية في Firebase:', doc.id);
                                    }
                                }
                            });
                            
                            if (foundDoc) {
                                data = foundDoc;
                                console.log('✅ البيانات موجودة في Firebase:', data);
                                
                                // حفظ في localStorage للسرعة
                                localStorage.setItem(localKey, JSON.stringify(data));
                            } else {
                                console.log('❌ لا توجد إجازة مرضية في Firebase بهذه البيانات');
                            }
                            
                        } catch (firebaseError) {
                            console.error('❌ خطأ في Firebase:', firebaseError);
                        }
                } else {
                    console.log('❌ Firebase غير متاح');
                }
                
                if (data) {
                    let resultHtml = `
    <div class="results-inquiery row">
        <div class="col-md-6"><span> الاسم:</span> ${data.name || ''}</div>
        <div class="col-md-6"><span>تاريخ إصدار تقرير الإجازة:</span> ${data.report_issue_date || ''}</div>
        <div class="col-md-6"><span>تبدأ من:</span> ${data.leave_start || ''}</div>
        <div class="col-md-6"><span>وحتى:</span> ${data.leave_end || ''}</div>
        <div class="col-md-6"><span>المدة بالأيام:</span> ${data.time || ''}</div>
        <div class="col-md-6"><span>اسم الممارس:</span> ${data.doctor_name || ''}</div>
        <div class="col-md-6"><span>المسمى الوظيفي:</span> ${data.role || ''}</div>
    </div>
`;

                    result.innerHTML = resultHtml;
                    result.style.display = 'block';
                    inquiryBtn.style.display = 'none';
                    newInquiryBtn.style.display = 'block';
                } else {
                    errorMessage.style.display = 'block';
                }
            } catch (error) {
                console.error('خطأ في الاستعلام:', error);
                errorMessage.style.display = 'block';
            }
        }

        function newInquiry() {
            document.getElementById("service_code").value = '';
            document.getElementById("id_number").value = '';
            document.getElementById('error-message').style.display = 'none';
            document.getElementById('result').style.display = 'none';
            document.getElementById('inquiry-btn').style.display = 'block';
            document.getElementById('new-inquiry-btn').style.display = 'none';
        }
    </script>

</body>
</html>
